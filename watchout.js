

var octocatPath = "m193.04469,140.20914c-1.87827,-0.31543 -3.83774,-0.52579 -5.42923,-0.58072l-0.27725,-0.00961c0.0621,-0.14099 0.10991,-0.23643 0.12909,-0.25078c0.03342,-0.02869 0.0621,-0.14828 0.0621,-0.26303c0,-0.06451 0.02869,-0.27243 0.07649,-0.5472c0.43011,0.01434 0.99883,0.02637 1.62491,0.03102c2.40411,0.01918 4.92279,0.21275 6.65283,0.51865c1.02762,0.18167 1.36691,0.17676 0.60703,-0.00964c-0.76952,-0.18643 -3.04921,-0.4588 -4.86542,-0.57817c-1.21866,-0.08377 -2.96782,-0.11475 -4.00038,-0.09808c0.02872,-0.17674 0.06709,-0.37743 0.1004,-0.58061c0.1483,-0.78859 0.196,-1.57962 0.196,-3.15672c0.00473,-2.44708 -0.12428,-3.12099 -0.92249,-4.73886c-0.32495,-0.65941 -0.69286,-1.22105 -1.13742,-1.72768c0.38719,-1.14221 0.37762,-2.91061 -0.01917,-4.46148c-0.33447,-1.27129 -0.44922,-1.35257 -1.60098,-1.10877c-0.97507,0.21021 -1.75873,0.49225 -2.76251,0.99881c-0.47787,0.23901 -1.13264,0.61174 -1.6058,0.90569c-1.23782,-0.43496 -2.51405,-0.72405 -3.88074,-0.87932c-1.38611,-0.15535 -4.77957,-0.0694 -5.98376,0.15283c-1.17567,0.2175 -2.23683,0.48512 -3.19736,0.80064c-0.47803,-0.29639 -1.17583,-0.69549 -1.6729,-0.94638c-1.00833,-0.50659 -1.79219,-0.78852 -2.77191,-0.99641c-1.14714,-0.24627 -1.26651,-0.16252 -1.59633,1.10877c-0.40616,1.56999 -0.41101,3.36936 -0.00957,4.50692c0.04765,0.12907 0.07634,0.22218 0.08606,0.2939c-1.62987,2.05518 -2.16032,4.35391 -1.80653,7.56322c0.09068,0.83655 0.23404,1.60352 0.4299,2.30617c-1.03702,-0.00488 -2.51868,0.03098 -3.58923,0.10037c-1.82088,0.12192 -4.10051,0.39177 -4.87003,0.5782c-0.75995,0.18414 -0.42065,0.19131 0.60696,0.01205c1.73004,-0.306 4.24872,-0.50194 6.65288,-0.51854c0.45396,-0.00252 0.87941,-0.01202 1.24739,-0.02151c0.1098,0.3727 0.23404,0.72649 0.37747,1.06332l-0.01434,0c-1.58669,0.05493 -3.54614,0.26282 -5.42439,0.58061c-1.40994,0.23663 -3.49377,0.70985 -3.73761,0.84608c-0.25323,0.14088 -0.04781,0.10986 1.04681,-0.16736c1.993,-0.50417 4.58339,-0.8912 7.79509,-1.16141l0.35851,-0.03098c0.68808,1.60101 1.74916,2.82211 3.24979,3.77571c0.91772,0.58305 2.38982,1.18279 3.13042,1.27829c0.20558,0.02408 0.7982,0.14577 1.31439,0.26767c0.52106,0.12192 1.54373,0.30594 2.26544,0.41118l0.01912,0c-0.01434,0.00951 -0.02869,0.01668 -0.03824,0.02385c-0.87941,0.45639 -1.4482,1.16611 -1.83044,2.28206c-0.1769,0.05258 -0.38719,0.12192 -0.62131,0.20319c-0.82689,0.28189 -1.15199,0.33923 -1.98837,0.34641c-0.87437,0.00484 -1.08005,-0.03102 -1.60086,-0.27711c-0.75517,-0.3513 -1.45784,-0.9989 -1.931,-1.77324c-0.78386,-1.29265 -2.14105,-2.20792 -3.26907,-2.20792c-0.96538,0 -1.15176,0.39186 -0.45396,0.96291c1.0563,0.86035 1.84,1.7374 2.16504,2.40651c0.18152,0.37512 0.45882,0.95824 0.62122,1.2903c0.16727,0.35614 0.5354,0.83894 0.88419,1.17105c0.81732,0.78148 1.6058,1.15416 2.78163,1.32867c0.78848,0.11708 0.98444,0.11708 1.9165,-0.00241c0.44919,-0.05496 0.82689,-0.11949 1.16611,-0.19838c0,0.37987 0,0.82208 0,1.33824c0,2.76486 -0.03346,3.65373 -0.13849,3.91428c-0.2103,0.49458 -0.67398,1.00359 -1.12308,1.23306c-0.44951,0.22943 -0.588,0.48038 -0.40154,0.71208c0.10518,0.12671 0.31061,0.14822 0.98459,0.10278c1.29033,-0.07886 2.19843,-0.55437 2.66211,-1.39316c0.14806,-0.2701 0.18629,-0.81241 0.22932,-3.63228c0.0526,-3.05644 0.07172,-3.35274 0.27229,-3.79008c0.11952,-0.25803 0.29642,-0.54004 0.39204,-0.61656c0.16255,-0.13626 0.17204,0.13147 0.17204,3.79001c0,4.03618 -0.03818,4.52374 -0.44456,5.30042c-0.09084,0.17674 -0.26273,0.4062 -0.38225,0.51619c-0.21515,0.19347 -0.30113,0.68579 -0.15283,0.83638c0.23889,0.23888 1.45743,-0.13872 2.12192,-0.66194c1.13264,-0.89616 1.26651,-1.63699 1.27608,-6.98746l0.00478,-3.13762l0.33939,0.03345l0.34407,0.0311l0.05737,4.10535c0.062,4.62163 0.07172,4.68867 0.8602,5.57997c0.44456,0.50417 0.89375,0.78383 1.62502,1.0013c0.97972,0.2939 1.27608,-0.1601 0.61652,-0.94637c-0.71692,-0.85789 -0.75038,-1.18521 -0.71214,-6.2561c0.02869,-3.25005 0.02869,-3.25005 0.23906,-3.06126c0.43962,0.40144 0.52568,1.05856 0.52568,4.10789c0,3.78763 0.1098,4.14601 1.44341,4.80797c0.62608,0.30589 0.80283,0.34175 1.60095,0.34657c0.85558,0.00235 0.90338,-0.00961 0.93669,-0.23186c0.02406,-0.18167 -0.08112,-0.30344 -0.47778,-0.54483c-0.52104,-0.32257 -0.88419,-0.73125 -1.10873,-1.24982c-0.08606,-0.19836 -0.14343,-1.50073 -0.18161,-4.18437c-0.05737,-3.7468 -0.07172,-3.91891 -0.30598,-4.5045c-0.31548,-0.79103 -0.79326,-1.41229 -1.405,-1.82567c-0.15778,-0.10515 -0.31555,-0.19119 -0.52106,-0.25574c0.25339,-0.02379 0.49699,-0.0502 0.73604,-0.08606c2.4613,-0.32732 3.76131,-0.59967 4.80803,-1.00345c2.20798,-0.85095 3.70398,-2.26323 4.51167,-4.26567c0.07172,-0.17924 0.14343,-0.34642 0.20547,-0.48265l0.62141,0.05017c3.21164,0.27249 5.80687,0.65709 7.79987,1.1638c1.09439,0.27711 1.29988,0.31055 1.04654,0.16484c-0.23894,-0.13382 -2.32271,-0.60451 -3.73265,-0.84113zm-9.41522,-0.04787c-0.36798,0.80049 -1.38602,1.83047 -2.20815,2.23682c-0.81247,0.39903 -2.08382,0.70497 -3.52223,0.85062c-0.9845,0.1004 -6.48083,0.12909 -7.38414,0.04066c-3.00612,-0.29388 -4.68842,-0.87233 -5.92641,-2.02885c-1.17583,-1.09924 -1.72047,-2.5928 -1.62979,-4.43042c0.06224,-1.14952 0.33939,-1.87111 1.06587,-2.74817c0.65955,-0.79816 1.3524,-1.29028 2.16982,-1.54126c0.68346,-0.21028 2.78633,-0.22945 5.61092,-0.04788c1.24739,0.07884 2.27963,0.07884 3.52718,0c2.9536,-0.1864 4.92268,-0.16489 5.64917,0.05988c1.147,0.35361 2.18886,1.30699 2.81494,2.57355c0.28204,0.56871 0.33942,0.81023 0.37762,1.68468c0.05737,1.20457 -0.15295,2.48769 -0.5448,3.35039zm-14.89716,-5.1785c-1.67767,-0.29388 -2.6382,2.5833 -1.34795,4.05054c0.61174,0.6978 1.15193,0.81252 1.83539,0.38948c0.62608,-0.3918 0.97015,-1.12776 0.97015,-2.07896c0,-1.27116 -0.57819,-2.20328 -1.4576,-2.36105zm10.19902,0.17212c-1.67752,-0.29398 -2.6382,2.5809 -1.35257,4.05051c0.61668,0.6978 1.15671,0.81248 1.84016,0.38716c0.62608,-0.392 0.97015,-1.12799 0.97015,-2.08139c0,-1.26416 -0.57843,-2.20085 -1.45775,-2.35628zm-4.51645,5.65633c-0.03825,0.11713 -0.2103,0.28925 -0.38704,0.38234c-0.44942,0.22948 -0.77429,0.14821 -1.24754,-0.282c-0.29149,-0.2652 -0.42535,-0.40379 -0.51141,-0.12654c-0.08598,0.25807 0.43507,0.77185 0.84123,0.92961c0.36798,0.14804 0.63086,0.15288 1.03224,-0.01434c0.39682,-0.16727 0.74561,-0.61176 0.74561,-0.90341c0,-0.26759 -0.38719,-0.25557 -0.47308,0.01434zm-0.49716,-0.90085c0.25333,-0.22461 0.3107,-0.68829 0.06709,-0.93443s-0.74083,-0.20792 -0.93207,0.06699c-0.22455,0.32249 -0.10518,0.56871 0.05737,0.83159c0.24861,0.19357 0.58305,0.23174 0.8076,0.03586z";
var height = 505;
var width = 660;
var svg = d3.select(".container").append("svg");
var time = 0;
var highScore = 0;

var data = d3.range(30).map(function(item){
  return {
    y: Math.floor(Math.random() * height),
    x: Math.floor(Math.random() * width),
  };
})



/* Player Code 
 * ========================================================================== */

var playerPos = {
  x: 0,
  y: 0
}

var dragPlayer = d3.behavior.drag()
  .on('drag', function(d, i) {
    playerPos.x = d3.event.x;
    playerPos.y = d3.event.y;
    var degrees = 360 * (Math.atan2(d3.event.dy,d3.event.dx)/(Math.PI*2));
    player.attr("transform", "rotate(" + degrees + "," + d3.event.x + "," + d3.event.y + ") translate(" +  d3.event.x + "," + d3.event.y + ")");
  });

var player = svg.append("path")
.attr("x", 0)
.attr("y", 0)
.attr("angle", 0)
.attr("r", 5)
.attr("d", "m-7.5,1.62413c0,-5.04095 4.08318,-9.12413 9.12414,-9.12413c5.04096,0 9.70345,5.53145 11.87586,9.12413c-2.02759,2.72372 -6.8349,9.12415 -11.87586,9.12415c-5.04096,0 -9.12414,-4.08318 -9.12414,-9.12415z")
.attr("fill", "orange")
.call(dragPlayer);


var checkCollision = function(enemy) {
  var parsePos = function(enemy) {
    debugger;
    var pos = enemy.attr("transform").match(/((\d+),(\d+))/g)[0].split(",")
    return pos;
  };

  var xDiff = parseFloat(parsePos(enemy)[0]) - playerPos.x;
  var yDiff = parseFloat(parsePos(enemy)[1]) - playerPos.y;

  var separation = Math.sqrt( Math.pow(xDiff, 2) + Math.pow(yDiff, 2) );

  if (separation < 15) {
    resetTimer();
  }
};

var resetTimer = function() {
  if (time > highScore) {
    d3.select(".high-score").text(time);
    highScore = time;
    time = 0;
  }
};


/* Enemy Code 
 * ========================================================================== */


// quick hack
/* var rect = svg.append("rect")
.attr({ width: 100, height: 100, x: 330, y: 200})
.style("fill", "#f7f7f7");

var playr = svg.append("path")
  .attr("d", octocatPath)
  .attr({"fill": "#4e1789", "stroke-width": "0", "stroke": "#ff0000"}); */


var purpleEnemies = svg.selectAll("path")
  .data(data)
  .enter()
  .append("path")
  .attr("class", "octocat")
  .attr("d", octocatPath)
  .attr({"fill": "#4e1789", "stroke-width": "0", "stroke": "#ff0000"})
  .attr("transform", function(d){ return "translate(" + d.x + "," + d.y + ")"});

var genRandom = function(n) {
  return Math.floor(Math.random() * n);
};

var tweenWithCollisionDetection = function(endData) {
  var enemy = d3.select(this);

  // startPos = {
  //   x: parseFloat(enemy.attr('x')),
  //   y: parseFloat(enemy.attr('y'))
  // }

  var endPos = {
    x: endData.x,
    y: endData.y 
  };

  return function(t) {
    checkCollision(enemy);
  };
};


var moveEnemies = function(enemies){
  enemies.transition()
    .duration(1000)
    .attr("transform", function(d) { return "translate(" + genRandom(width) + "," + genRandom(height) + ")" })
    .tween("custom", tweenWithCollisionDetection);
};

setInterval(function(){
  moveEnemies(purpleEnemies);
}, 2000);

/* Game  Code 
 * ========================================================================== */

setInterval(function() {
  d3.select(".current-score").text(function() { return time++; })
}, 50);

